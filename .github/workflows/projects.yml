name: Process Project Submission

on:
  issues:
    types: [opened, edited, labeled]

jobs:
  process-issue:
    # Only run if the issue has the specific label to avoid processing random issues
    if: contains(github.event.issue.labels.*.name, 'project-submission')
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Needed to push the JSON file back to the repo

    steps:
      - name: Checkout Code
        uses: actions/checkout@v5

      - name: Install uv
        uses: astral-sh/setup-uv@v7

      - name: Install the project
        run: uv sync --all-extras --dev

      - name: Parse Issue and Save JSON
        env:
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
        run: uv run scripts/parse_issue.py

      - name: Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update project data for Issue #${{ github.event.issue.number }}"
          file_pattern: "data/projects/*.json"